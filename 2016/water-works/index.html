<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Data Pipeline configuration oddities</title>
  <meta name="description" content="">
  <meta name="author" content="Logan Akamatsu ">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Logan Akamatsu">
  <meta name="twitter:description" content="">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Logan Akamatsu">
  <meta property="og:description" content="">

  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <link rel="icon" sizes="16x16 32x32 64x64" href="/images/favicons/favicon.ico">
  <link rel="icon" type="image/png" sizes="196x196" href="/images/favicons/favicon-192.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/images/favicons/favicon-160.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/images/favicons/favicon-96.png">
  <link rel="icon" type="image/png" sizes="64x64" href="/images/favicons/favicon-64.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16.png">
  <link rel="apple-touch-icon" href="/images/favicons/favicon-57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/favicon-114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/favicon-72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/favicon-144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/favicon-60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/favicon-120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/favicon-76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/favicon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/favicon-180.png">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-TileImage" content="/images/favicons/favicon-144.png">
  <meta name="msapplication-config" content="/browserconfig.xml">


  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://loganakamatsu.github.io//2016/water-works/">
  <link rel="alternate" type="application/rss+xml" title="Logan Akamatsu" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Logan Akamatsu">
          <!-- <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo"> -->
          <h1 class="panel-cover__title panel-title">Logan Akamatsu</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description"></p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Logan Akamatsu blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/loganakamatsu" title="@loganakamatsu on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            
              <!-- Facebook -->
              <li class="navigation__item">
                <a href="http://fb.me/loganakamatsu" title="loganakamatsu on Facebook" target="_blank">
                  <i class="icon icon-social-facebook"></i>
                  <span class="label">Facebook</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/loganakamatsu" title="loganakamatsu on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/loganakamatsu" title="loganakamatsu on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:website@loganakamatsu.com" title="Email website@loganakamatsu.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- Instagram -->
            <li class="navigation__item">
              <a href="https://www.instagram.com/loganakamatsu" title="loganakamatsu on Instagram" target="_blank">
                <i class="icon icon-social-instagram"></i>
                <span class="label">Instagram</span>
              </a>
            </li>

            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="17 Apr 2016" class="post-meta__date date">17 Apr 2016</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#waterworks">waterworks</a> <a href="/tags/#data pipeline">data pipeline</a> <a href="/tags/#ruby">ruby</a> </span>
    </div>
    <h1 class="post-title">Data Pipeline configuration oddities</h1>
  </header>

  <section class="post">
    <p>I&#39;ve been working for a little while on a
<a href="https://rubygems.org/gems/waterworks">gem</a> to configure and deploy <a href="https://aws.amazon.com/datapipeline/">AWS Data
Pipelines.</a> At my day job, we use Data
Pipeline to schedule various types of repeating jobs. If you&#39;re interested, you
can see more details on <a href="https://mobiledefense.com/blog/2016/04/04/waterworks/">the company
blog.</a> To summarize, we
wanted a library to configure Data Pipelines as Ruby objects so we could easily
compose, reuse, version control, etc. </p>

<p>In developing waterworks, we decided to build on top of the Ruby AWS SDK. We
chose Ruby mostly because we didn&#39;t think that any one AWS SDK had significant
advantages for Data Pipeline and secondarily because most people in the
company are comfortable with Ruby. One other advantage of the Ruby SDK instead
of something like Java is that the hashes expected by the SDK are very similar
to the JSON ones used by the CLI and web console.</p>

<p>However, there is a caveat to this since the format used is subtly different:</p>

<p>JSON <a href="http://docs.aws.amazon.com/datapipeline/latest/DeveloperGuide/dp-copydata-redshift-define-pipeline-cli.html">see reference</a></p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nt">"objects"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_id"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_name"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"field_key_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"field_value_1"</span><span class="p">,</span><span class="w">
      </span><span class="err">...</span><span class="w">
      </span><span class="nt">"field_key_n"</span><span class="p">:</span><span class="w"> </span><span class="s2">"field_value_n"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Ruby <a href="http://docs.aws.amazon.com/sdkforruby/api/Aws/DataPipeline/Client.html#put_pipeline_definition-instance_method">see reference</a></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span>
  <span class="ss">pipeline_objects: </span><span class="p">[</span> <span class="c1"># required</span>
    <span class="p">{</span>
      <span class="ss">id: </span><span class="s2">"my_id"</span><span class="p">,</span> <span class="c1"># required</span>
      <span class="ss">name: </span><span class="s2">"my_name"</span><span class="p">,</span> <span class="c1"># required</span>
      <span class="ss">fields: </span><span class="p">[</span> <span class="c1"># required</span>
        <span class="p">{</span>
          <span class="ss">key: </span><span class="s2">"field_key_1"</span><span class="p">,</span> <span class="c1"># required</span>
          <span class="ss">string_value: </span><span class="s2">"field_value_1"</span><span class="p">,</span>
          <span class="c1"># or</span>
          <span class="ss">ref_value: </span><span class="s2">"field_value_1"</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">.</span><span class="nf">.</span><span class="o">.</span>
      <span class="p">],</span>
    <span class="p">},</span>
    <span class="p">.</span><span class="nf">.</span><span class="o">.</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>The main difference is that the fields of each Pipeline Object are encapsulated
differently. In the JSON object, the fields are on the same level as the <code>id</code>
and <code>name</code>. In the Ruby Hash format, the fields are encapsulated in a <code>field</code>
array with objects that have a <code>key</code> and an explicit <code>string_value</code> or
<code>ref_value</code>. In the JSON format, the designation of string or reference is
implicit. This is a slight annoyance, but since each field is bound to a type
(see the fields tables in an <a href="http://docs.aws.amazon.com/datapipeline/latest/DeveloperGuide/dp-object-emrcluster.html#emrcluster-syntax">example
object</a>)
we can easily build this into our logic. </p>

  </section>
  
</article>



      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2016 Logan Akamatsu . All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75928247-1', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>